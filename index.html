<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <title>Recipe Generator</title>
  <style>
    html {
      width: 100%;
      height: 100%;
      font-family: 'Inter', sans-serif;
      font-size: large;
      box-sizing: border-box;
      padding: .5rem;
    }

    h1,
    p {
      margin: .25rem;
    }

    div {
      margin: .25rem;
    }

    main {
      margin: auto;
      width: 80%;
      color: #000000;
    }

    main h1 {
      font-weight: bold;
    }

    .banner h1,
    p {
      max-width: 500px;
      text-align: center;
    }

    .banner {
      border-radius: 8px;
      margin: auto;
      height: 250px;
      background-image: url(banner.png);
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
      color: #eee;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }
    .parent {
  font-size: 0;
  width: 100%;
  display: flex;
  margin-top: 40px;
}
    .content-body-left,
    .content-body-right {
      vertical-align: top;
      font-size: 16px;
    }

    .content-body-left {
      flex: 3;     

    }

    .content-body-right {
      flex: 2;
      border-radius: 10px;
      border: 1px solid #ccc;
      text-align: left;
    }

    .content-body-right p {
      text-align: left;
      padding-left: 8px;
    }

    .newline {
      display: block;
      margin-bottom: .25rem;
    }

    .print-button,
    .reset-button,
    .submit-button {
      cursor: pointer;
      border-radius: 50px;
      border: none;
      padding: .5rem;
      font-size: large;
      justify-content: center;
      display: block;
      color: white;
      text-align: right;
      background-color:#1E8B50;
      width: 100%;
      text-align: center;
    }
    .submit-button:hover {
      border: none;
      background-color: #4c8667;
    }
fieldset {
  border:none;
}
    legend {
      border: none;
    }
    .input-parent {
      
      margin-top: 20px;
     
    }
    .input-right {
      background-color: aqua;
      width:20%;
      float: right;
    }

    .input-left {
      width:70%;
    }

    .detailsBox {
      border: none;
      font-size: 0.8rem;
      border-radius: 30px; 
      width: 100%;
      padding-left: 10px;
      box-sizing: border-box; /* Ensures padding is part of the width */
      height: 40px;
      border:  1px solid #1E8B50;
    }

    input:focus {
  border: 2px solid #1E8B50; /* Thicker border when focused */
  outline: none; /* Remove default focus outline */
}

input[type="radio"] {
  accent-color: #1E8B50; 
  border: 2px solid #1E8B50; 
}

    input[type=button][disabled] {
      background-color: #eee;
      color: darkgray;
      cursor: not-allowed;
    }

    .grow {
      flex-grow: 1;
    }

    pre {
      font-family: "Gill Sans", sans-serif;
    }

    .output {
      width: 50%;
      text-wrap: wrap;
    }

    @media (max-width: 767px) {
      .output {
        width: 100%;
      }
    }

    textarea {
      padding: .5rem;
      display: block;
    }

    .category {
      display: flex;
      flex-direction: row;
      align-items: center;
      flex-wrap: wrap;
      flex-grow: 1;
    }

    .image {
      object-fit: cover;
      height: 100%;
    }

    .sample-prompts {
      background-color: #1E8B50;
      border-radius: 10px;
      padding-top: 10px;
      padding-bottom: 10px;
      padding-left: 10px;
      box-sizing: border-box;
    }

    .sample-prompts p {
      background-color: #F2F2F2;
      border-radius: 15px;
      height: 30px;
      margin-bottom: 5px;
      font-size: 0.5rem;
      padding-left:10px ;
      padding-top: 10px;
      padding-right: 10px;
      padding-bottom: 5px;
      color: #666666;
      box-sizing: border-box;
    }
.sample-prompts-parent {
  display: flex; /* Enables flex layout */
}
    .child-prompts-parent {
      text-align: center;
    }
    

    @media print {
      .non-printableArea {
        display: none;
      }
    }

    a:link {
      color: lightblue;
      text-decoration: none;
    }

    a:visited {
      color: lightblue;
      ;
    }

    a:hover {
      color: blue;
      background-color: white;
    }

    a:active {
      color: lightblue;
      ;
    }
  </style>
</head>

<body>
  <main>
    <div class="banner">
      <h1>Generate Delicious Recipes <br>in Seconds!</h1>
      <p>First choose a dish category of your choice, then describe the details of
        the recipe you want and let our A.I do the rest for you.</p>
    </div>
<div class="parent">
  <div class="content-body-left">
      <section>
        <div>
          <fieldset>
            <legend>Choose a Dish Category:</legend>
            <div class="category">
              <div>
                <input type="radio" value="jollof_rice" name="recipes" />
                <label for="jollof_rice">Jollof Rice</label>
              </div>
              <div>
                <input type="radio" value="salad" name="recipes" />
                <label for="cake">Salad</label>
              </div>

              <div>
                <input type="radio" value="yam_porridge" name="recipes" />
                <label for="yam_porridge">Yam Porridge &nbsp; &nbsp;</label>
              </div>

              <div>
                <input type="radio" value="soup" name="recipes" />
                <label for="cookies">Soup</label>
              </div>

              <div>
                <input type="radio" value="shawarma" name="recipes" />
                <label for="shawarma">Shawarma</label>
              </div>
            </div>
          </fieldset>
        </div>
        <div>
          <label class="newline" for="details">Enter recipe details, or see an example preference below </label>
          <div>
              <input id="details" class="detailsBox" type="text" name="details" placeholder="Enter the Ingredients you have or a recipe detail..."> 
            </div>
        </div>

        <div class="grow" style="display: flex; flex-direction: column">
          <div class="">
            <input id="submit-button" class="submit-button" type="button" value="Generate a recipe" />
          </div>

          <div class="grow">
            <input id="print-button" class="noprint print-button" type="button" value="Print a recipe" />
          </div>
          <div class="grow">
            <input id="reset-button" class="reset-button" type="button" value="Try another recipe" />
          </div>
        </div>
      </section>
      <section>
        <div class="sample-prompts">
          <h4>Example Prompts</h4>
          <div class="sample-prompts-parent">
            <div class="child-prompts-parent"><p>I have eggs, tomatoes and peppers</p></div>
            <div class="child-prompts-parent"><p>I need the recipe for Party Jollof Rice</p></div>
          </div>
          <div class="sample-prompts-parent">
            <div class="child-prompts-parent"><p>Fruit Salad recipe with Cucumber and Lettuce</p></div>
            <div class="child-prompts-parent"><p>Pepper Soup Recipe</p></div>
          </div>
          <div class="sample-prompts-parent">
            <div class="child-prompts-parent"><p>Healthy vegetarian recipe with lentils & Beans</p></div>
            <div class="child-prompts-parent"><p>Recipe for Shawarma</p></div>
          </div>
          <div>
            
            
          </div>
        </div>
      </section>
    </div>
    <div class="content-body-right" id="recipe-container">
      <p>Recipe Generated</p>
      <hr>
      <p id="recipe-content"></p>
    </div>
</div>
    
  </main>
  <script>

function convertWhatsAppMarkdownToHTML(text) {
    // Bold (*text*)
    text = text.replace(/\*([^\*]+)\*/g, '<p>$1</p>');
    
    // Italic (_text_)
    text = text.replace(/_([^_]+)_/g, '<i>$1</i>');
    
    // Strikethrough (~text~)
    text = text.replace(/~([^~]+)~/g, '<s>$1</s>');
    
    // Monospace (```text```)
    text = text.replace(/```([^`]+)```/g, '<code>$1</code>');
    
    // Return the converted text
    return text;
}
const protocol = window.location.protocol;
const hostname = window.location.hostname;
const port = window.location.port;
const baseUrl = `${protocol}//${hostname}${port ? `:${port}` : ''}`;

const serverUrl = `${baseUrl}/api/recipe`; // Update with your server's endpoint

    function hideOutput() {
      document.querySelector("#recipe-container").style.display = "none";
    }
    function showOutput() {
      document.querySelector("#recipe-container").style.display = "flex";
    }
    function disableButton(id) {
      document.getElementById(id).disabled = true;
    }
    function enableButton(id) {
      document.getElementById(id).disabled = false;
    }

    document.addEventListener("DOMContentLoaded", (e) => {
      document
        .querySelector("#reset-button")
        .addEventListener("click", (e) => {
          location.reload();
        });

      document
        .querySelector("#print-button")
        .addEventListener("click", (e) => {
          window.print();
        });

      enableButton("submit-button");
      disableButton("print-button");
      disableButton("reset-button");

      const requestData = {};
      document
        .querySelector("#submit-button")
        .addEventListener("click", async (e) => {
          const categorySelected = document.querySelector(
            'input[name="recipes"]:checked'
          );
          const detailsInput = document.querySelector("#details").value;
          if (!(categorySelected && detailsInput.length > 0)) {
            alert("Choose a category and enter detail about the recipe");
          } else {
            requestData.category = categorySelected.value;
            requestData.details = detailsInput;
            showOutput();
            disableButton("submit-button");
            enableButton("reset-button");
            // format chat AI prompt
            // recipe?prompt=Create+a+recipe+for+cake+described+as+chocolate`

            // Chat to get Recipe

            // const chatPrompt = `${requestData.category} described as ${requestData.details}`;
            const chatPrompt = {
        prompt: `Assuming you are a seasoned chef. Come up with the best recipe to make ${requestData.category} with the following additional descriptions: ${requestData.details}`,
      };        

      try {
        const response = await fetch(serverUrl, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(chatPrompt),
        });

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();
              if (data) {
                const recipeContent = convertWhatsAppMarkdownToHTML(data.recipe);
          document.querySelector("#recipe-content").innerHTML = recipeContent;
          enableButton("print-button");
              }
            } catch (error) {
        console.error("Error fetching the recipe:", error);
        alert("Failed to fetch the recipe. Please try again.");
        enableButton("submit-button");
      }
    }
        });
    });
  </script>
</body>

</html>